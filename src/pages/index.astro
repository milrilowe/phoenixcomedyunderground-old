---
// src/pages/index.astro
import "@/styles/global.css";
import Desktop from "@/components/Desktop.astro";
import Mobile from "@/components/Mobile.astro";

// SEO Configuration
const seo = {
  title: "Phoenix Comedy Underground - Best of Phoenix Showcase | August 6",
  description:
    "Phoenix Comedy Underground presents the Best of Phoenix Showcase on August 6 at Cornish Pasty Co. Doors 7:30 PM, Show 8:00 PM. Experience the city's top underground comedy talent. 21+ event.",
  canonical: "https://phoenixcomedyunderground.com",
  ogImage: "https://phoenixcomedyunderground.com/card-preview.png",
  twitterImage: "https://phoenixcomedyunderground.com/card-preview.png",
};

// Structured Data
const eventSchema = {
  "@context": "https://schema.org",
  "@type": "Event",
  name: "Phoenix Comedy Underground: Best of Phoenix Showcase",
  description:
    "Experience Phoenix's top underground comedy talent at Cornish Pasty Co. Doors at 7:30 PM, show starts at 8:00 PM.",
  startDate: "2025-06-25T20:00:00-07:00",
  endDate: "2025-06-25T22:30:00-07:00",
  doorTime: "2025-06-25T19:30:00-07:00",
  eventStatus: "https://schema.org/EventScheduled",
  eventAttendanceMode: "https://schema.org/OfflineEventAttendanceMode",
  location: {
    "@type": "Place",
    name: "Cornish Pasty Co.",
    address: {
      "@type": "PostalAddress",
      streetAddress: "7 W. Monroe",
      addressLocality: "Phoenix",
      addressRegion: "AZ",
      postalCode: "85003",
      addressCountry: "US",
    },
  },
  organizer: {
    "@type": "Organization",
    name: "Phoenix Comedy Underground",
    url: "https://phoenixcomedyunderground.com",
  },
  offers: {
    "@type": "Offer",
    url: "https://www.eventbrite.com/e/phoenix-comedy-underground-best-of-phoenix-showcase-tickets-1380218563879",
    availability: "https://schema.org/InStock",
  },
  image: "https://phoenixcomedyunderground.com/cornish-pasty-08-06-2025.png",
  performer: {
    "@type": "Organization",
    "@id": "https://phoenixcomedyunderground.com",
    name: "Phoenix Comedy Underground",
  },
};

const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: "Phoenix Comedy Underground",
  url: "https://phoenixcomedyunderground.com",
  description:
    "Phoenix's premier underground comedy collective showcasing raw, unfiltered humor",
  sameAs: ["https://instagram.com/phoenixcomedyunderground"],
  contactPoint: {
    "@type": "ContactPoint",
    contactType: "customer service",
    email: "contact@phoenixcomedyunderground.com",
  },
};
---

<html lang="en">
  <head>
    <!-- Basic Meta Tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/favicon-32x32.png" sizes="32x32" type="image/png" />
    <link rel="icon" href="/favicon-16x16.png" sizes="16x16" type="image/png" />

    <!-- Optional but good to have -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="theme-color" content="#000000" />

    <!-- SEO Meta Tags -->
    <title>{seo.title}</title>
    <meta name="description" content={seo.description} />
    <meta
      name="keywords"
      content="Phoenix comedy, underground comedy, comedy show, Phoenix entertainment, stand-up comedy, comedy showcase, Phoenix events, Cornish Pasty Co, August 6"
    />
    <meta name="author" content="Phoenix Comedy Underground" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={seo.canonical} />

    <!-- Open Graph Tags -->
    <meta property="og:title" content={seo.title} />
    <meta property="og:description" content={seo.description} />
    <meta property="og:image" content={seo.ogImage} />
    <meta property="og:url" content={seo.canonical} />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Phoenix Comedy Underground" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={seo.title} />
    <meta name="twitter:description" content={seo.description} />
    <meta name="twitter:image" content={seo.twitterImage} />
    <meta name="twitter:site" content="@phoenixcomedyunderground" />

    <!-- Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(eventSchema)} />
    <script
      type="application/ld+json"
      set:html={JSON.stringify(organizationSchema)}
    />

    <!-- Preload Critical Resources -->
    <link rel="preload" href="/cornish-pasty-08-06-2025.png" as="image" />

    <!-- Check for 'src' URLSearchParam -->
    <script is:inline>
      const params = new URLSearchParams(window.location.search);
      const src = params.get("src");
      if (src) {
        localStorage.setItem("qrSource", src);
      }
    </script>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-264VJ9QCQP"
    ></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-264VJ9QCQP");
    </script>

    <!-- Meta Pixel Code -->
    <script>
      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod
            ? n.callMethod.apply(n, arguments)
            : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = "2.0";
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        "script",
        "https://connect.facebook.net/en_US/fbevents.js",
      );
      fbq("init", "1761241071270732");
      fbq("track", "PageView");
    </script>
    <noscript
      ><img
        height="1"
        width="1"
        style="display:none"
        src="https://www.facebook.com/tr?id=1761241071270732&ev=PageView&noscript=1"
      /></noscript
    >
    <!-- End Meta Pixel Code -->

    <!-- Enhanced Tracking for Flyer Campaign -->
    <script is:inline>
      // Track page view with source context
      window.addEventListener("load", function () {
        const source = localStorage.getItem("qrSource") || "direct";

        // Track page view with source
        if (window.gtag) {
          gtag("event", "page_view", {
            event_category: "engagement",
            event_label: `landing_page_${source}`,
            custom_parameter_1: source,
            value: 1,
          });
        }

        // Track if this is a flyer scan
        if (source.startsWith("flyer_")) {
          gtag("event", "flyer_scan", {
            event_category: "marketing",
            event_label: source,
            value: 1,
          });
        }
      });

      // Time on page tracking for engagement measurement
      let startTime = Date.now();
      let tracked30s = false;
      let tracked60s = false;

      setInterval(function () {
        const timeOnPage = (Date.now() - startTime) / 1000;
        const source = localStorage.getItem("qrSource") || "direct";

        // Track 30 second engagement
        if (timeOnPage >= 30 && !tracked30s && source.startsWith("flyer_")) {
          tracked30s = true;
          gtag("event", "engagement_30s", {
            event_category: "engagement",
            event_label: `flyer_engaged_${source}`,
            value: 30,
          });
        }

        // Track 60 second engagement
        if (timeOnPage >= 60 && !tracked60s && source.startsWith("flyer_")) {
          tracked60s = true;
          gtag("event", "engagement_60s", {
            event_category: "engagement",
            event_label: `flyer_engaged_${source}`,
            value: 60,
          });
        }
      }, 5000); // Check every 5 seconds
    </script>
  </head>
  <body>
    <!-- Skip to main content for accessibility -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-yellow-400 text-zinc-900 px-4 py-2 rounded z-50"
    >
      Skip to main content
    </a>

    <main id="main-content">
      <!-- Desktop Layout -->
      <Desktop />
      <!-- Mobile Layout -->
      <Mobile />
    </main>
  </body>
</html>

<style>
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .focus\:not-sr-only:focus {
    position: static;
    width: auto;
    height: auto;
    padding: 0.5rem 1rem;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
</style>
